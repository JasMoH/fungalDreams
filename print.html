<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fungal Dreams</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="documentation_tools.html"><strong aria-hidden="true">2.</strong> Documentation tools</a></li><li class="chapter-item expanded "><a href="docker/docker.html"><strong aria-hidden="true">3.</strong> Docker stuff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="docker/interactive.html"><strong aria-hidden="true">3.1.</strong> Interactive Docker</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fungal Dreams</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="what-is-this-mess"><a class="header" href="#what-is-this-mess">what is this mess?</a></h1>
<p>This is a place to put my thoughts and musings on software development, embedded development, and the like.
common lessons, resources for learning things, code snipets, etc. You can see the source for all of this
<a href="https://github.com/JasMoH/fungalDreams">at my github page</a></p>
<p>I find that I periodically want to collect tutorials, learning resources, tools, and other useful things
all in one place for myself or as a resource for team-members and friends. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="documentation-matters"><a class="header" href="#documentation-matters">Documentation Matters</a></h1>
<p>Communication is an important part of making anything. I generally find that documents that
aren't attached to the codebase are easily lost. I also generally dislike some of the
format restrictions that are imposed by common tools used in corporate environments such as
the microsoft office suite. Basic digital features such as hypertext, hiararchical navigation,
and integration with version control systems are important features for communicating effectivly about
a rapidly changing and complicated subject such as an ongoing software project.</p>
<h1 id="mdbook"><a class="header" href="#mdbook">mdbook</a></h1>
<p>This page was created with <a href="https://github.com/rust-lang/mdBook">mdbook</a>, which is a tool for turning markdown files into webpages, 
PDFs, and other finished products. This is well suited to co-existing with code or other version controlled
artifacts, and can be readily integrated with <a href="https://rust-lang.github.io/mdBook/continuous-integration.html">continuous integration</a> systems and deployed to hosting
services like github/gitlab pages.</p>
<p>Install with: </p>
<pre><code class="language-shell script">cargo install mdbook
</code></pre>
<h1 id="mermaidjs"><a class="header" href="#mermaidjs">mermaid.js</a></h1>
<p><a href="https://mermaid-js.github.io/mermaid/#/">mermaid.js</a> can be <a href="https://github.com/badboy/mdbook-mermaid">integrated with mdbook</a> as a preproccessor.
It produces a variety of useful diagrams such as these:</p>
<pre class="mermaid">graph TD;
    A--&gt;B;
    A--&gt;C;
    B--&gt;D;
    C--&gt;D;
</pre>
<pre class="mermaid">graph BT
    A[You can Even make monoidal objects!] --&gt;|With multiple| A
    A --&gt;|Automorphisms| A
</pre>
<p>The <a href="https://jojozhuang.github.io/tutorial/mermaid-cheat-sheet/">mermaid cheatsheet</a> is a good
resource for mermaid syntax.</p>
<p>Install mdbook-mermaid with:</p>
<pre><code class="language-shell script">cargo install mdbook-mermaid
mdbook-mermaid install path/to/your/book
</code></pre>
<p>your book.toml will be update to include the following lines to invoke the mermaid preprocessor.</p>
<pre><code class="language-shell script">[preprocessor.mermaid]
command = &quot;mdbook-mermaid&quot;

[output.html]
additional-js = [&quot;mermaid.min.js&quot;, &quot;mermaid-init.js&quot;]
</code></pre>
<h1 id="wavedrom"><a class="header" href="#wavedrom">wavedrom</a></h1>
<p><a href="https://wavedrom.com">Wavedrom</a> will render digital timing diagrams from JSON descriptions, and is integrated with
<a href="https://github.com/JasMoH/mdbook-wavedrom">mdbook-wavedrom</a>. A <a href="https://wavedrom.com/editor.html">live wavedrom editor</a> is available.</p>
<body onload="WaveDrom.ProcessAll()">
<script type="WaveDrom">{signal: [
  {name: 'clk', wave: 'p.....|...'},
  {name: 'dat', wave: 'x.345x|=.x', data: ['head', 'body', 'tail', 'data']},
  {name: 'req', wave: '0.1..0|1.0'},
  {},
  {name: 'ack', wave: '1.....|01.'}
]}
</script>
<p>wavedrom is installed the same way as mermaid</p>
<pre><code class="language-shell script">cargo install mdbook-wavedrom
mdbook-wavedrom install path/to/your/book
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="some-notes-on-what-docker-is-for-the-uninitiated"><a class="header" href="#some-notes-on-what-docker-is-for-the-uninitiated">some notes on what docker is for the uninitiated</a></h1>
<p>New users to docker often find it hard to know where to start. Many tutorials dive right in to deploying 
containers without really saying what a container <em>is</em>. This attempts to collect some observations that
I've found useful for explaining docker to newbies.</p>
<h2 id="docker-is-confusing"><a class="header" href="#docker-is-confusing">Docker is confusing</a></h2>
<p>The reason why docker is confusing to learn about is because it isn't really <em>one</em> thing, it's
a collection of many tools that solve many problems. Because there's no single problem it solves, there's also
no single way it is used, hence the differences between docker run, docker-compose, and more advanced frameworks like
kuberenetes.</p>
<p>Docker can be used for some wildly different problems:</p>
<ul>
<li>controlling development and compilation environments</li>
<li>coordinating server side services such as load balances and databases</li>
</ul>
<p>These problems have very different needs, and use very different sets of features in different ways.</p>
<h2 id="docker-is-chroot--sorta"><a class="header" href="#docker-is-chroot--sorta">Docker is chroot ... sorta</a></h2>
<p>I find it easiest to start to think through what docker is by building up from something simpler.
The simplest thing that you could call &quot;a container&quot; is <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> with 
a bunch of extra convenience tools. chroot allows you to have a separate file system in a box.
Notably, anything that runs in the chroot container still runs natively, and has access to anyting that isn't
hidden by the file system, such as network, physical hardware, kernel modules, etc. You can look at something like <a href="https://github.com/RPi-Distro/pi-gen">pi-gen</a> as an example of something
that uses chroot to build up an entire operating system. </p>
<p>The scripting in pigen is rather single purpose, so docker provides a bunch of convenience features
to manage building and running containers. this <a href="https://devops.stackexchange.com/questions/2826/difference-between-chroot-and-docker">stack exchange</a>
article lists the nice bits:</p>
<ul>
<li>A standardized script file format including semantics relating to the task a hand</li>
<li>Images (including anonymous in-between images), caching, naming, downloading etc. including powerful management (docker image prune ...)</li>
<li>Containers (including their own temporary file systems, naming, being able to docker exec into them etc.)</li>
<li>Process management (docker container ...)</li>
<li>Networking with just a simple option, including intra-docker-container-networking etc.</li>
<li>Volumes (including special managed volumes)</li>
<li>docker-compose or swarm as low-profile upgrades to much more.</li>
<li>The large zoo of other solutions based on dockerized containers (OpenShift etc.).</li>
</ul>
<h2 id="docker-is-more-than-chroot"><a class="header" href="#docker-is-more-than-chroot">Docker is more than chroot</a></h2>
<p>chroot only provides isolation on the file system, docker also provides isolation on:</p>
<ul>
<li>mnt namespace provides a root filesystem</li>
<li>pid namespace so the process only sees itself and its children</li>
<li>network namespace which allows the container to have its dedicated network stack</li>
<li>user namespace (quite new) which allows a non root user on a host to be mapped with the root user within the container</li>
<li>uts provides dedicated hostname</li>
<li>ipc provides dedicated shared memory</li>
</ul>
<h2 id="there-are-many-ways-to-use-containers"><a class="header" href="#there-are-many-ways-to-use-containers">There are many ways to use containers</a></h2>
<p>There are a ton of tools for configuring and running containers: <code>docker run</code>, <code>docker-compose</code>, k8s, and others.
They all provide different ways to select your containers, and configure them to run in a bunch of different ways.
You can run containers interactively for debugging or developing other software, or cluster them together and spool them up based
on dynamic loading in a larger system </p>
<p>These different user interfaces to the same underlying container system evolved somewhat independently, and feel
like they are almost unrelated tools. As best as I can tell, that's because they are. </p>
<h2 id="most-of-these-differences-are-related-to-side-effects"><a class="header" href="#most-of-these-differences-are-related-to-side-effects">Most of these differences are related to side-effects</a></h2>
<p>If the containers perfectly isolated their contents from the outside world these programs would run
on the exact same files and environmental variables as inputs, isolated from the outside network every time.
Any changes they made to those files or variables are discarded, and nothing they try to send gets to the network.
This is useless! The whole point of computing is to do something with the real world other than burn CPU.
When you run a container you usually expose network ports, mount files, set environmental variables, and harvest the output.
In other words, controlling the side effects available for your container to change. These different tools have 
wildly different styles for specifying and managing all these options.</p>
<p>This also means a single container can have different uses and different behavior depending on how it is invoked.
This isn't any different from any other program that has run-time decision making based on reading some environmental input.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-shell-for-interactive-development"><a class="header" href="#example-shell-for-interactive-development">example shell for interactive development</a></h1>
<p>This is a variation of a script I have migrated as a snippet between a few different projects. I find it
useful for debugging containers, as well as carrying around a clean development environment.</p>
<p>It is possible to use this to completely encapsulate your development environment, which can be especially
useful for complicated C/C++ toolchains.</p>
<pre><code class="language-shell">#!/bin/bash

set -e

# ensure docker containers are built on latest
pushd demo_build
./build.sh
popd

pushd interactive_demo_environment
./build.sh
popd

##################################################
# build parameter list
##################################################

# interactive
PARAMS+=&quot; --interactive --tty&quot;

#mount contents of PWD
PARAMS+=&quot; -v $PWD/..:/usr/src/project&quot;

#set the working directyr as the project directory
PARAMS+=&quot; -w /usr/src/project&quot;

##################################################
# mount some user info
# normally docker provides user isolation, but it can be
# convinient to have your user outside the container inside the container
# so you have write permissions for files created in mounted volumes, sudo privildges, etc.
##################################################

#mount passwd files and run as current user
#this will permit use of sudo inside the container
PARAMS+=&quot; -v /etc/passwd:/etc/passwd:ro&quot;
PARAMS+=&quot; -v /etc/group:/etc/group:ro&quot;
PARAMS+=&quot; -v  /etc/shadow:/etc/shadow:ro&quot;
PARAMS+=&quot; -u $(id -u):$(id -g)&quot; #runs as current user

#mount x server for gui use
# PARAMS+=&quot; -v /tmp/.X11-unix:/tmp/.X11-unix&quot;
PARAMS+=&quot; -e DISPLAY=${DISPLAY}&quot;
# PARAMS+=&quot; --device=/dev/video0:/dev/video0&quot;
PARAMS+=&quot; -v $HOME/.Xauthority:/$HOME/.Xauthority&quot;

##################################################
# consider mounting other contents of your home directory, such as .bashrc, git preferences, etc.
# this can bring some of your working environment in to the container
##################################################

# there are a couple ways of mounting xauth permissions and displays, this is useful if the container is running
# on a remote server and will need to forward the xwindow over ssh

# PARAMS+=&quot; -e HOST=cctv&quot;
# DISPLAY_NUMBER=$(echo $DISPLAY | cut -d. -f1 | cut -d: -f2)
# AUTH_COOKIE=$(xauth list | grep &quot;^$(hostname)/unix:${DISPLAY_NUMBER} &quot; | awk '{print $3}')
# xauth add ${HOST}/unix:${DISPLAY_NUMBER} MIT-MAGIC-COOKIE-1 ${AUTH_COOKIE}
# python /path/to/program.py
# PARAMS+=&quot; -e AUTH_COOKIE=${AUTH_COOKIE}&quot;


# here are some common group and privilidge options that are neccesary for hardware access from time to time
# avoid using them if they aren't neccesary, and be vary careful about pushing them in to production
# PARAMS+=&quot; --privileged&quot;
# PARAMS+=&quot; --group-add dailout&quot;

# if don't want docker to provide network isolation
# PARAMS+=&quot; --network=host&quot;



##################################################
# run the container
##################################################

echo $PARAMS
# xhost +local:docker
docker run $PARAMS interactive_demo_env
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>
        <script type="text/javascript" src="wavedrom.min.js"></script>
        <script type="text/javascript" src="wavedrome-default.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
